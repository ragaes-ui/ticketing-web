<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCELLFEST | Beli Tiket Konser & Event Online</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <style>
        :root {
            --primary-blue: #0049CC; /* Biru Khas Loket */
            --dark-navy: #0e1e3b;    /* Footer */
            --bg-light: #f8f9fa;
            --text-dark: #333;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: white;
            color: var(--text-dark);
            padding-top: 76px; /* Space navbar */
        }

        /* 1. Navbar Clean */
        .navbar {
            background-color: white;
            box-shadow: 0 1px 10px rgba(0,0,0,0.05);
            padding: 15px 0;
            height: 76px;
        }
        .navbar-brand {
            font-weight: 800;
            color: var(--primary-blue) !important;
            font-size: 1.4rem;
            letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 8px;
        }
        .nav-link { font-weight: 500; color: #555; margin: 0 10px; }
        .nav-link:hover { color: var(--primary-blue); }

        /* 2. Hero Banner Wide */
        .hero-section {
            background: linear-gradient(to right, #0049CC, #007bff);
            padding: 40px 0 80px 0; /* Padding bawah gede buat space search bar */
            color: white;
            position: relative;
            overflow: hidden;
        }
        /* Hiasan background abstrak */
        .hero-bg-circle {
            position: absolute;
            width: 400px; height: 400px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            top: -100px; right: -50px;
        }
        
        /* 3. Search Bar Floating */
        .search-wrapper {
            margin-top: -35px; /* Narik ke atas biar nempel banner */
            margin-bottom: 40px;
        }
        .search-box {
            background: white;
            padding: 10px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        .search-input {
            border: none; outline: none; flex-grow: 1; padding: 10px 20px; font-size: 1rem;
        }
        .btn-search {
            background: var(--primary-blue); color: white;
            border: none; padding: 10px 30px; border-radius: 40px;
            font-weight: 600; transition: 0.3s;
        }
        .btn-search:hover { background: #003db3; }

        /* 4. Icon Categories (Ciri Khas) */
        .category-item {
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            padding: 10px;
            border-radius: 12px;
        }
        .category-item:hover { background: #f0f7ff; }
        .icon-circle {
            width: 50px; height: 50px;
            background: #e6f0ff;
            color: var(--primary-blue);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 10px auto;
        }
        .cat-text { font-size: 0.85rem; font-weight: 600; color: #555; }

        /* 5. Event Card Modern */
        .card-event {
            border: 1px solid #eee;
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            background: white;
            height: 100%;
            display: flex; flex-direction: column;
        }
        .card-event:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.08);
            border-color: transparent;
        }
        
        .card-img-top {
            height: 160px;
            background: linear-gradient(135deg, #0049CC, #4facfe);
            position: relative;
            display: flex; align-items: center; justify-content: center;
            color: white;
        }
        .date-float {
            position: absolute; bottom: 10px; left: 10px;
            background: white; color: #333;
            padding: 4px 10px; border-radius: 8px;
            font-weight: 700; font-size: 0.8rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .event-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 5px; line-height: 1.4; }
        .event-venue { font-size: 0.85rem; color: #888; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; }
        
        .price-start { font-size: 0.75rem; color: #888; margin-bottom: 0; }
        .price-val { font-size: 1.1rem; font-weight: 700; color: #ff5e1f; }
        
        .btn-outline-book {
            border: 1px solid var(--primary-blue);
            color: var(--primary-blue);
            font-weight: 600;
            padding: 8px;
            border-radius: 8px;
            background: white;
            width: 100%;
            margin-top: auto;
        }
        .btn-outline-book:hover { background: var(--primary-blue); color: white; }
        .btn-outline-book.disabled { border-color: #ddd; color: #aaa; background: #f9f9f9; }

        /* 6. Footer Besar (Sama kayak Admin) */
        .footer-loket {
            background-color: var(--dark-navy);
            color: white;
            padding: 60px 0 30px 0;
            margin-top: 80px;
            font-size: 0.9rem;
        }
        .footer-head { font-weight: 700; margin-bottom: 20px; color: white; font-size: 1rem; }
        .footer-link { display: block; color: #b0c0d6; text-decoration: none; margin-bottom: 10px; transition: 0.2s; }
        .footer-link:hover { color: white; text-decoration: underline; }
        .social-btn {
            width: 36px; height: 36px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2);
            display: inline-flex; align-items: center; justify-content: center;
            color: white; margin-right: 10px; text-decoration: none;
        }
        .social-btn:hover { background: white; color: var(--dark-navy); }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-ticket-detailed-fill"></i> RCELLFEST
            </a>
            
            <div class="collapse navbar-collapse justify-content-center d-none d-lg-block">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="#">Jelajah</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Tentang Kami</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Blog</a></li>
                </ul>
            </div>

            <div id="navUserArea">
                <a href="user-login.html" class="btn btn-outline-primary rounded-pill px-4 fw-bold">Masuk / Daftar</a>
            </div>
        </div>
    </nav>

    <section class="hero-section text-center">
        <div class="hero-bg-circle"></div>
        <div class="container position-relative z-1">
            <h1 class="fw-bold display-5 mb-3">Serunya Hidup, <br>Dimulai dari Tiketmu.</h1>
            <p class="opacity-75 lead mb-5">Jelajahi ribuan event seru, konser musik, hingga workshop kreatif.</p>
        </div>
    </section>

    <div class="container">
        <div class="row justify-content-center search-wrapper">
            <div class="col-md-8">
                <div class="search-box">
                    <i class="bi bi-search text-secondary ms-3"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Cari event seru, artis, atau lokasi...">
                    <button onclick="searchEvent()" class="btn-search">Cari</button>
                </div>
            </div>
        </div>

        <div class="row justify-content-center mb-5 g-2">
            <div class="col-3 col-md-2" onclick="resetSearch()">
                <div class="category-item">
                    <div class="icon-circle"><i class="bi bi-grid-fill"></i></div>
                    <div class="cat-text">Semua</div>
                </div>
            </div>
            <div class="col-3 col-md-2">
                <div class="category-item">
                    <div class="icon-circle"><i class="bi bi-music-note-beamed"></i></div>
                    <div class="cat-text">Konser</div>
                </div>
            </div>
            <div class="col-3 col-md-2">
                <div class="category-item">
                    <div class="icon-circle"><i class="bi bi-trophy-fill"></i></div>
                    <div class="cat-text">Olahraga</div>
                </div>
            </div>
            <div class="col-3 col-md-2">
                <div class="category-item">
                    <div class="icon-circle"><i class="bi bi-palette-fill"></i></div>
                    <div class="cat-text">Workshop</div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold m-0">ðŸ”¥ Event Pilihan Hari Ini</h4>
            <a href="#" class="text-decoration-none fw-bold small" onclick="resetSearch()">Lihat Semua <i class="bi bi-arrow-right"></i></a>
        </div>

        <div class="row g-4" id="event-list">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="mt-2 text-secondary">Sedang menyiapkan event terbaik...</p>
            </div>
        </div>
    </div>

    <footer class="footer-loket">
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-3 col-6">
                    <div class="footer-head">Tentang Rcellfest</div>
                    <a href="#" class="footer-link">Cara Kerja</a>
                    <a href="#" class="footer-link">Tentang Kami</a>
                    <a href="#" class="footer-link">Karir</a>
                    <a href="#" class="footer-link">Blog</a>
                </div>
                <div class="col-lg-3 col-6">
                    <div class="footer-head">Untuk Penyelenggara</div>
                    <a href="#" class="footer-link">Buat Event</a>
                    <a href="#" class="footer-link">Biaya Layanan</a>
                    <a href="#" class="footer-link">Panduan</a>
                    <a href="login.html" class="footer-link text-warning">Login Admin</a>
                </div>
                <div class="col-lg-3 col-6">
                    <div class="footer-head">Bantuan</div>
                    <a href="#" class="footer-link">Hubungi Kami</a>
                    <a href="#" class="footer-link">Pusat Bantuan</a>
                    <a href="#" class="footer-link">Kebijakan Privasi</a>
                    <a href="#" class="footer-link">Syarat & Ketentuan</a>
                </div>
                <div class="col-lg-3">
                    <div class="footer-head">Ikuti Kami</div>
                    <div class="mb-4">
                        <a href="#" class="social-btn"><i class="bi bi-instagram"></i></a>
                        <a href="#" class="social-btn"><i class="bi bi-twitter-x"></i></a>
                        <a href="#" class="social-btn"><i class="bi bi-youtube"></i></a>
                    </div>
                    <div class="footer-head mb-2">Download Aplikasi</div>
                    <button class="btn btn-outline-light btn-sm w-100 text-start mb-2"><i class="bi bi-apple me-2"></i> App Store</button>
                    <button class="btn btn-outline-light btn-sm w-100 text-start"><i class="bi bi-google-play me-2"></i> Google Play</button>
                </div>
            </div>
            <hr class="border-secondary my-5">
            <div class="text-center text-white-50 small">
                &copy; 2026 PT Rcelltech Global Indonesia. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        let allEvents = [];

        // 1. CEK LOGIN
        function checkLoginStatus() {
            const userRaw = localStorage.getItem('userData');
            const navArea = document.getElementById('navUserArea');

            if (userRaw) {
                const user = JSON.parse(userRaw);
                navArea.innerHTML = `
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle d-flex align-items-center gap-2 border rounded-pill px-3" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle fs-5 text-primary"></i>
                            <span class="small fw-bold">${user.username}</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2 p-2 rounded-4">
                            <li><a class="dropdown-item rounded-2" href="dashboard.html"><i class="bi bi-ticket-perforated me-2"></i>Tiket Saya</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><button class="dropdown-item rounded-2 text-danger" onclick="logout()"><i class="bi bi-box-arrow-right me-2"></i>Keluar</button></li>
                        </ul>
                    </div>
                `;
            } else {
                navArea.innerHTML = `<a href="user-login.html" class="btn btn-outline-primary rounded-pill px-4 fw-bold">Masuk / Daftar</a>`;
            }
        }

        function logout() {
            localStorage.removeItem('userData');
            localStorage.removeItem('userToken');
            window.location.reload();
        }

        // 2. LOAD EVENTS
        async function loadEvents() {
            try {
                const res = await fetch('/api/events');
                allEvents = await res.json();
                renderEvents(allEvents);
            } catch (err) {
                console.error(err);
            }
        }

        // 3. RENDER CARD
        function renderEvents(data) {
            const container = document.getElementById('event-list');
            container.innerHTML = ''; 

            if(data.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-emoji-frown display-1 text-secondary opacity-25"></i>
                        <p class="mt-3 text-secondary">Maaf, event yang kamu cari tidak ditemukan.</p>
                        <button onclick="resetSearch()" class="btn btn-outline-primary btn-sm">Lihat Semua</button>
                    </div>`;
                return;
            }

            data.forEach(event => {
                const harga = new Intl.NumberFormat('id-ID').format(event.price);
                const isSoldOut = event.availableSeats <= 0;
                const dateObj = new Date(event.date);
                const dateStr = dateObj.toLocaleDateString('id-ID', {day: 'numeric', month: 'short', year: 'numeric'});

                container.innerHTML += `
                    <div class="col-md-6 col-lg-3">
                        <div class="card-event">
                            <div class="card-img-top">
                                <i class="bi bi-music-note-beamed display-4 opacity-50"></i>
                                <div class="date-float">${dateStr}</div>
                            </div>
                            
                            <div class="card-body">
                                <h5 class="event-title text-truncate">${event.name}</h5>
                                <div class="event-venue">
                                    <i class="bi bi-geo-alt-fill text-danger"></i> ICE BSD City
                                </div>

                                <p class="price-start">Mulai dari</p>
                                <div class="price-val mb-3">Rp ${harga}</div>

                                <button onclick="buyTicket('${event._id}')" 
                                    class="btn btn-outline-book ${isSoldOut ? 'disabled' : ''}">
                                    ${isSoldOut ? 'HABIS TERJUAL' : 'PILIH TIKET'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // 4. SEARCH FUNCTION
        function searchEvent() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allEvents.filter(e => e.name.toLowerCase().includes(keyword));
            renderEvents(filtered);
        }

        document.getElementById('searchInput').addEventListener("keypress", function(e) {
            if (e.key === "Enter") searchEvent();
        });
        
        function resetSearch() {
            document.getElementById('searchInput').value = '';
            renderEvents(allEvents);
        }

        // 5. BUY LOGIC (Same as before)
        async function buyTicket(eventId) {
            const userRaw = localStorage.getItem('userData');
            if (!userRaw) {
                Swal.fire({
                    title: 'Login Dulu Yuk!',
                    text: 'Kamu harus login buat amanin tiket ini.',
                    icon: 'info',
                    confirmButtonText: 'Login Sekarang',
                    confirmButtonColor: '#0049CC',
                    showCancelButton: true
                }).then((r) => { if(r.isConfirmed) window.location.href = 'user-login.html'; });
                return;
            }
            const user = JSON.parse(userRaw);
            const confirm = await Swal.fire({
                title: 'Konfirmasi Pesanan',
                html: `<div class="bg-light p-3 rounded text-start"><small class="text-secondary">Pemesan</small><br><strong>${user.username}</strong><br>${user.email}</div><p class="mt-3">Lanjut bayar?</p>`,
                icon: 'question', showCancelButton: true, confirmButtonText: 'Bayar', confirmButtonColor: '#0049CC'
            });

            if (confirm.isConfirmed) {
                Swal.fire({ title: 'Memproses...', didOpen: () => Swal.showLoading() });
                try {
                    const res = await fetch('/api/order', {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ eventId, quantity: 1, customerName: user.username, customerEmail: user.email })
                    });
                    const data = await res.json();
                    if (res.ok) {
                        Swal.fire({ title: 'Berhasil!', text: 'Tiket sudah masuk dashboard kamu.', icon: 'success', confirmButtonColor: '#0049CC' }).then(() => loadEvents());
                    } else { Swal.fire('Gagal', data.message, 'error'); }
                } catch (err) { Swal.fire('Error', 'Server bermasalah', 'error'); }
            }
        }

        checkLoginStatus();
        loadEvents();
    </script>
</body>
</html>
