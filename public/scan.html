<!DOCTYPE html>
<html lang="id">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Gatekeeper Scanner</title>
Â  Â Â 
Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
Â  Â Â 
Â  Â  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

Â  Â  <style>
Â  Â  Â  Â  /* Gaya Hacker Matrix */
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  background: #000;Â 
Â  Â  Â  Â  Â  Â  color: #0f0;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Courier New', Courier, monospace;Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  align-items: center;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  height: 100vh;Â 
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanner-box {Â 
Â  Â  Â  Â  Â  Â  border: 2px solid #0f0;Â 
Â  Â  Â  Â  Â  Â  padding: 30px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 10px;Â 
Â  Â  Â  Â  Â  Â  width: 90%;Â 
Â  Â  Â  Â  Â  Â  max-width: 500px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);Â 
Â  Â  Â  Â  Â  Â  background: #111;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  input {Â 
Â  Â  Â  Â  Â  Â  background: #222 !important;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #0f0 !important;Â 
Â  Â  Â  Â  Â  Â  color: #0f0 !important;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  input::placeholder { color: #004400; }
Â  Â  Â  Â  input:focus {Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 15px #0f0 !important;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-scan {Â 
Â  Â  Â  Â  Â  Â  background: #0f0;Â 
Â  Â  Â  Â  Â  Â  color: black;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;Â 
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  transition: 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-scan:hover {Â 
Â  Â  Â  Â  Â  Â  background: #fff;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 20px #fff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-scan:disabled {
Â  Â  Â  Â  Â  Â  background: #333;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div class="scanner-box text-center">
Â  Â  Â  Â  <h1 class="mb-2">ğŸ•µï¸â€â™‚ï¸ GATE CONTROL</h1>
Â  Â  Â  Â  <p class="mb-4 text-secondary small">SYSTEM READY...</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <form id="scanForm">
Â  Â  Â  Â  Â  Â  <div class="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="ticketCode" class="form-control py-3" placeholder="SCAN / INPUT CODE" autocomplete="off" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button type="submit" id="btnSubmit" class="btn btn-scan w-100 py-3">
Â  Â  Â  Â  Â  Â  Â  Â  SCAN TICKET
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </form>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // Cek apakah SweetAlert berhasil di-load
Â  Â  Â  Â  window.onload = function() {
Â  Â  Â  Â  Â  Â  if (typeof Swal === 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  alert("GAWAT! Library Notifikasi (SweetAlert) gagal dimuat. Cek koneksi internet Abang!");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  document.getElementById('scanForm').addEventListener('submit', async (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const inputCode = document.getElementById('ticketCode');
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('btnSubmit');
Â  Â  Â  Â  Â  Â  const code = inputCode.value.trim(); // Hapus spasi gak penting

Â  Â  Â  Â  Â  Â  if (!code) return;

Â  Â  Â  Â  Â  Â  // 1. Ubah Tombol jadi Loading (Biar tau kodenya jalan)
Â  Â  Â  Â  Â  Â  const originalText = btn.innerText;
Â  Â  Â  Â  Â  Â  btn.innerText = "SEARCHING DATABASE...";
Â  Â  Â  Â  Â  Â  btn.disabled = true;

Â  Â  Â  Â  Â  Â  console.log("Mengirim request untuk kode:", code); // Cek di Console

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Tembak ke Server
Â  Â  Â  Â  Â  Â  Â  Â  const res = await fetch('/api/validate', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ ticketCode: code })
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Balasan Server:", data); // Cek di Console

Â  Â  Â  Â  Â  Â  Â  Â  // 3. Tampilkan Notif Berdasarkan Hasil
Â  Â  Â  Â  Â  Â  Â  Â  if (data.valid) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- TIKET VALID (HIJAU) ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Mainkan Suara (Opsional)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play().catch(e => console.log(e));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'âœ… ACCESS GRANTED',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<h3 style="color:#fff">${data.data.event}</h3><p>Guest: <b>${data.data.name}</b></p>`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: 'success',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background: '#000',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#0f0', // Teks Hijau
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonColor: '#0f0',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonText: 'MASUK BOS!',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timer: 3000 // Otomatis nutup dalam 3 detik
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- TIKET INVALID / SUDAH DIPAKAI (MERAH) ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'â›” ACCESS DENIED',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html: `<h4 style="color:#fff">${data.message}</h4><p class="text-secondary">${data.detail || ''}</p>`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: 'error',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background: '#000',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#f44', // Teks Merah
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonColor: '#f44',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmButtonText: 'TOLAK'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error Fetch:", err);
Â  Â  Â  Â  Â  Â  Â  Â  // Notif kalau Server Mati / Error Coding
Â  Â  Â  Â  Â  Â  Â  Â  Swal.fire({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'SYSTEM ERROR',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: 'Gagal menghubungi server. Cek terminal VS Code!',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: 'warning',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  background: '#000',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: 'orange'
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  // 4. Balikin Tombol & Kosongkan Input
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = originalText;
Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  inputCode.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  inputCode.focus();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
